"use strict";(self.webpackChunkcosici=self.webpackChunkcosici||[]).push([[348],{6348:(F,f,a)=>{a.r(f),a.d(f,{UsersModule:()=>k});var p=a(6814),d=a(5476),t=a(4769),l=a(9862),_=a(9413);let g=(()=>{class o{constructor(){this.baseUrl=_.N.baseUrl,this.http=(0,t.f3M)(l.eN)}getUsers(){const e=`${this.baseUrl}/api/auth`,r=localStorage.getItem("token"),n=(new l.WM).set("Authorization",`Bearer ${r}`);return this.http.get(e,{headers:n})}getUserById(e){const r=localStorage.getItem("token"),n=(new l.WM).set("Authorization",`Bearer ${r}`);return this.http.get(`${this.baseUrl}/api/auth/${e}`,{headers:n})}addUser(e){const r=localStorage.getItem("token"),n=(new l.WM).set("Authorization",`Bearer ${r}`);return this.http.post(`${this.baseUrl}/api/auth`,e,{headers:n})}updateUser(e,r){const n=`${this.baseUrl}/api/auth/${e}`,i=localStorage.getItem("token"),u=(new l.WM).set("Authorization",`Bearer ${i}`);return this.http.patch(n,r,{headers:u})}static#t=this.\u0275fac=function(r){return new(r||o)};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function b(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"span")(4,"strong"),t._uU(5,"Nombre:"),t.qZA(),t._uU(6),t.qZA()(),t.TgZ(7,"div",7)(8,"strong"),t._uU(9,"Email:"),t.qZA(),t._uU(10),t.qZA(),t.TgZ(11,"div",8)(12,"button",9),t.NdJ("click",function(){const i=t.CHM(e).$implicit,u=t.oxw();return t.KtG(u.navigateToUserDetail(i._id))}),t.TgZ(13,"i"),t._uU(14,"Edit"),t.qZA()()()()()}if(2&o){const e=c.$implicit;t.xp6(6),t.hij(" ",e.name,""),t.xp6(4),t.hij(" ",e.email,"")}}let w=(()=>{class o{constructor(e,r){this.usersService=e,this.router=r,this.users=[]}ngOnInit(){this.loadUsers()}loadUsers(){this.usersService.getUsers().subscribe({next:e=>{this.users=e},error:e=>{console.error("There was an error!",e)}})}navigateToUserDetail(e){this.router.navigate(["/dashboard/users",e])}createUser(){this.router.navigate(["/dashboard/users/add"])}static#t=this.\u0275fac=function(r){return new(r||o)(t.Y36(g),t.Y36(d.F0))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-list-users"]],decls:8,vars:1,consts:[[1,"users-list-container","container"],[1,"text-center"],[1,"text-center","title","pt-5","pb-5"],[1,"edit-btn","create-btn",3,"click"],["class","user-card",4,"ngFor","ngForOf"],[1,"user-card"],[1,"user-info"],[1,"user-detail"],[1,"user-detail","user-actions","text-center"],[1,"edit-btn",3,"click"]],template:function(r,n){1&r&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"Gestion de usuarios admin"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.createUser()}),t.TgZ(5,"i"),t._uU(6,"Create Users"),t.qZA()()(),t.YNc(7,b,15,2,"div",4),t.qZA()),2&r&&(t.xp6(7),t.Q6J("ngForOf",n.users))},dependencies:[p.sg],styles:[".users-list-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#fff;margin-bottom:1rem}.users-list-container[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]{background-color:#fff;box-shadow:0 4px 8px #0000001a;border-radius:10px;overflow:hidden;width:100%;display:flex;flex-direction:column;justify-content:space-between;margin-bottom:1rem}.users-list-container[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;padding:1rem;justify-content:space-between;flex-wrap:wrap}.users-list-container[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-detail[_ngcontent-%COMP%]{width:45%;display:flex;align-items:center;color:#34495e}@media (max-width: 768px){.users-list-container[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-detail[_ngcontent-%COMP%]{text-align:center;width:100%}}.users-list-container[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{width:10%}@media (max-width: 768px){.users-list-container[_ngcontent-%COMP%]   .user-card[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{display:block;text-align:center;width:100%}}.edit-btn[_ngcontent-%COMP%]{width:70px;display:inline;background:#f74149;color:#fff;border:none;cursor:pointer;padding:10px;border-radius:5px;transition:background-color .3s}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#d3555b}.create-btn[_ngcontent-%COMP%]{width:165px;margin-bottom:1.5rem}"]})}return o})();var s=a(95),x=a(3519),m=a.n(x),h=a(5699);function C(o,c){if(1&o&&(t.TgZ(0,"div",19),t._uU(1),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.dictionary.getText("passwordsDoNotMatch")," ")}}function P(o,c){if(1&o&&(t.TgZ(0,"div")(1,"div",4)(2,"label",12),t._uU(3),t.qZA(),t._UZ(4,"input",13),t.qZA(),t.TgZ(5,"div",4)(6,"label",14),t._uU(7),t.qZA(),t._UZ(8,"input",15),t.qZA(),t.TgZ(9,"div",4)(10,"label",16),t._uU(11),t.qZA(),t._UZ(12,"input",17),t.YNc(13,C,2,1,"div",18),t.qZA()()),2&o){const e=t.oxw();let r;t.xp6(3),t.Oqu(e.dictionary.getText("currentlyPassword")),t.xp6(4),t.Oqu(e.dictionary.getText("newPassword")),t.xp6(4),t.Oqu(e.dictionary.getText("confirmPassword")),t.xp6(2),t.Q6J("ngIf",(null==(r=e.myForm.get("confirmPassword"))?null:r.touched)&&e.myForm.hasError("mismatch"))}}function U(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"h5",20),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.togglePasswordFields(!0))}),t._uU(1),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.hij(" ",e.dictionary.getText("changePassword")," ")}}function y(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"h5",20),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.togglePasswordFields(!1))}),t._uU(1),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.hij(" ",e.dictionary.getText("doNotChangePassword")," ")}}let M=(()=>{class o{constructor(e,r,n,i){this.route=e,this.userService=r,this.dictionary=n,this.router=i,this.fb=(0,t.f3M)(s.qu),this.userId="",this.showPasswordFields=!1,this.isEmailDisabled=!0,this.myForm=this.fb.group({email:["",[s.kI.required,s.kI.email]],name:["",[s.kI.required,s.kI.minLength(3)]],password:[""],newPassword:[""],confirmPassword:[""]},{validators:this.passwordsMatch.bind(this)})}ngOnInit(){this.route.params.subscribe(e=>{this.userId=e.id,this.loadUserDetail()})}loadUserDetail(){this.userService.getUserById(this.userId).subscribe(e=>{this.myForm.patchValue({email:e.email,name:e.name})})}onSubmit(){this.myForm.valid&&this.userService.updateUser(this.userId,this.myForm.value).subscribe({next:e=>{m().fire({title:"Updated",icon:"success"})},error:e=>{m().fire("Error",e,"error")}})}togglePasswordFields(e){this.showPasswordFields=e;const r=this.myForm.get("password"),n=this.myForm.get("newPassword"),i=this.myForm.get("confirmPassword");r&&n&&i&&(e?(r.setValidators([s.kI.minLength(6)]),n.setValidators([s.kI.required,s.kI.minLength(6)]),i.setValidators([s.kI.required,s.kI.minLength(6)])):(r.clearValidators(),n.clearValidators(),i.clearValidators()),r.updateValueAndValidity(),n.updateValueAndValidity(),i.updateValueAndValidity())}passwordsMatch(e){if(!this.showPasswordFields)return null;const r=e.get("newPassword"),n=e.get("confirmPassword");return r&&n?r.value===n.value?null:{mismatch:!0}:{invalidForm:"Invalid form control"}}static#t=this.\u0275fac=function(r){return new(r||o)(t.Y36(d.gz),t.Y36(g),t.Y36(h.E),t.Y36(d.F0))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-user-detail"]],decls:19,vars:10,consts:[[1,"pt-2"],[1,"text-center","text-white"],[1,"user-detail-form"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","email"],["id","email",1,"fw-bold","text-white"],["for","name"],["type","text","id","name","formControlName","name",1,"form-control","custom-input-internal"],[4,"ngIf"],["type","submit",1,"btn","btn-send",3,"disabled"],["class","text-right pt-4 change-password",3,"click",4,"ngIf"],["for","password"],["type","password","id","password","formControlName","password",1,"form-control","custom-input-internal"],["for","newPassword"],["type","password","id","newPassword","formControlName","newPassword",1,"form-control","custom-input-internal"],["for","confirmPassword"],["type","password","id","confirmPassword","formControlName","confirmPassword",1,"form-control","custom-input-internal"],["class","text-required",4,"ngIf"],[1,"text-required"],[1,"text-right","pt-4","change-password",3,"click"]],template:function(r,n){if(1&r&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2),t.qZA(),t.TgZ(3,"div",2)(4,"form",3),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(5,"div",4)(6,"label",5),t._uU(7),t.qZA(),t.TgZ(8,"p",6),t._uU(9),t.qZA()(),t.TgZ(10,"div",4)(11,"label",7),t._uU(12),t.qZA(),t._UZ(13,"input",8),t.qZA(),t.YNc(14,P,14,4,"div",9),t.TgZ(15,"button",10),t._uU(16),t.qZA(),t.YNc(17,U,2,1,"h5",11),t.YNc(18,y,2,1,"h5",11),t.qZA()()()),2&r){let i;t.xp6(2),t.hij(" ",n.dictionary.getText("EditUsersAdmin")," "),t.xp6(2),t.Q6J("formGroup",n.myForm),t.xp6(3),t.Oqu(n.dictionary.getText("email")),t.xp6(2),t.hij(" ",null==(i=n.myForm.get("email"))?null:i.value," "),t.xp6(3),t.Oqu(n.dictionary.getText("name")),t.xp6(2),t.Q6J("ngIf",n.showPasswordFields),t.xp6(1),t.Q6J("disabled",!n.myForm.valid),t.xp6(1),t.hij(" ",n.dictionary.getText("saveChanges")," "),t.xp6(1),t.Q6J("ngIf",!n.showPasswordFields),t.xp6(1),t.Q6J("ngIf",n.showPasswordFields)}},dependencies:[p.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u],styles:[".user-detail-form[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;padding:20px;border:1px solid #ced4da;border-radius:8px;background-color:transparent;box-shadow:0 4px 6px #0000001a}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#fff}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ced4da;border-radius:4px;font-size:16px}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]:focus{border-color:#d3555b;outline:0;box-shadow:0 0 0 .2rem #d3555b85}.user-detail-form[_ngcontent-%COMP%]   .btn-send[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 15px;font-size:18px;border-radius:5px;border:none;cursor:pointer;background-color:#f74149;color:#fff}.user-detail-form[_ngcontent-%COMP%]   .btn-send[_ngcontent-%COMP%]:disabled{background-color:#9e5457ea}.change-password[_ngcontent-%COMP%]{color:#fff;cursor:pointer}"]})}return o})();function O(o,c){1&o&&(t.TgZ(0,"span"),t._uU(1,"\u{1f648}"),t.qZA())}function v(o,c){1&o&&(t.TgZ(0,"span"),t._uU(1,"\u{1f441}\ufe0f"),t.qZA())}const Z=[{path:"",component:w},{path:"add",component:(()=>{class o{constructor(e,r,n,i){this.route=e,this.dictionary=r,this.userService=n,this.router=i,this.fb=(0,t.f3M)(s.qu),this.showPassword=!1,this.userId="",this.myForm=this.fb.group({email:["",[s.kI.required,s.kI.email]],name:["",[s.kI.required,s.kI.minLength(3)]],password:["",[s.kI.required,s.kI.minLength(6)]]})}ngOnInit(){}onSubmit(){this.myForm.valid&&this.userService.addUser({...this.myForm.value,roles:["control"]}).subscribe({next:e=>{m().fire({title:"Created",icon:"success"}),this.router.navigate(["/dashboard/users"])},error:e=>{m().fire("Error",e,"error")}})}toggleShowPassword(){this.showPassword=!this.showPassword}static#t=this.\u0275fac=function(r){return new(r||o)(t.Y36(d.gz),t.Y36(h.E),t.Y36(g),t.Y36(d.F0))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-users"]],decls:23,vars:10,consts:[[1,"pt-5"],[1,"text-center","text-white"],[1,"user-detail-form","pt-5"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","email",1,"form-control","custom-input-internal"],["for","name"],["type","text","id","name","formControlName","name",1,"form-control","custom-input-internal"],["for","password"],[1,"input-group"],["type","password","id","password","formControlName","password",1,"form-control","custom-input-internal",3,"type"],["type","button",1,"btn","btn-secondary",3,"click"],[4,"ngIf"],["type","submit",1,"btn","btn-send",3,"disabled"]],template:function(r,n){1&r&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2),t.qZA(),t.TgZ(3,"div",2)(4,"form",3),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(5,"div",4)(6,"label",5),t._uU(7),t.qZA(),t._UZ(8,"input",6),t.qZA(),t.TgZ(9,"div",4)(10,"label",7),t._uU(11),t.qZA(),t._UZ(12,"input",8),t.qZA(),t.TgZ(13,"div",4)(14,"label",9),t._uU(15),t.qZA(),t.TgZ(16,"div",10),t._UZ(17,"input",11),t.TgZ(18,"button",12),t.NdJ("click",function(){return n.toggleShowPassword()}),t.YNc(19,O,2,0,"span",13),t.YNc(20,v,2,0,"span",13),t.qZA()()(),t.TgZ(21,"button",14),t._uU(22),t.qZA()()()()),2&r&&(t.xp6(2),t.hij(" ",n.dictionary.getText("createAdminUser")," "),t.xp6(2),t.Q6J("formGroup",n.myForm),t.xp6(3),t.Oqu(n.dictionary.getText("email")),t.xp6(4),t.Oqu(n.dictionary.getText("name")),t.xp6(4),t.Oqu(n.dictionary.getText("password")),t.xp6(2),t.Q6J("type",n.showPassword?"text":"password"),t.xp6(2),t.Q6J("ngIf",n.showPassword),t.xp6(1),t.Q6J("ngIf",!n.showPassword),t.xp6(1),t.Q6J("disabled",!n.myForm.valid),t.xp6(1),t.hij(" ",n.dictionary.getText("createUser")," "))},dependencies:[p.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u],styles:[".user-detail-form[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;padding:20px;border:1px solid #ced4da;border-radius:8px;background-color:transparent;box-shadow:0 4px 6px #0000001a}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#fff}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ced4da;border-radius:4px;font-size:16px}.user-detail-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]:focus{border-color:#d3555b;outline:0;box-shadow:0 0 0 .2rem #d3555b85}.user-detail-form[_ngcontent-%COMP%]   .btn-send[_ngcontent-%COMP%]{display:block;width:100%;padding:10px 15px;font-size:18px;border-radius:5px;border:none;cursor:pointer;background-color:#f74149;color:#fff}.user-detail-form[_ngcontent-%COMP%]   .btn-send[_ngcontent-%COMP%]:disabled{background-color:#9e5457ea}.input-group[_ngcontent-%COMP%]{display:flex;align-items:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{flex:1}.input-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:transparent;margin-left:-20px}"]})}return o})()},{path:":id",component:M}];let T=(()=>{class o{static#t=this.\u0275fac=function(r){return new(r||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[d.Bz.forChild(Z),d.Bz]})}return o})(),k=(()=>{class o{static#t=this.\u0275fac=function(r){return new(r||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[p.ez,T,l.JF,s.UX]})}return o})()}}]);